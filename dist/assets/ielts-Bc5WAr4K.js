import{j as e,F as j,c as b,e as k,f as C,g as T,V as d,i as u,h as f,r as S,B as x,k as v,M as w,C as F,S as L,l as P,m as M,n as O,o as A,p as R}from"./index-CR9qUmRE.js";const Y=()=>e.jsx(j.Item,{name:"title",label:"Test nomi",rules:[{required:!0,message:"Test nomini kiriting"}],children:e.jsx(b,{placeholder:"Test nomini kiriting",size:"middle"})}),U=()=>{const n=k();return C({mutationFn:async t=>(await T.post(u.all,t)).data,onSuccess:()=>{n.invalidateQueries({queryKey:[u.all]}),d.success("Muvaffaqiyatli yaratildi")},onError:()=>{d.error("Yaratishda xatolik yuz berdi")}})},N=()=>{const n=k();return C({mutationFn:async({id:t,...o})=>(await T.patch(u.one(t),o)).data,onSuccess:()=>{n.invalidateQueries({queryKey:[u.all]}),d.success("Muvaffaqiyatli yangilandi")},onError:()=>{d.error("Yangilashda xatolik yuz berdi")}})},Q=({hideAddButton:n=!1})=>{const[t]=j.useForm(),{mutateAsync:o,isPending:a}=U(),{mutateAsync:s,isPending:m}=N(),{open:h,onClose:p,data:i}=f(),l=()=>{t.resetFields(),p()};S.useEffect(()=>{i&&t.setFieldsValue(i)},[i,t]);const y=async c=>{try{i?i.id&&await s({...c,id:i.id}):await o(c),l()}catch(g){console.error("Error saving IELTS:",g)}};return e.jsxs("div",{className:"flex items-center justify-end",children:[!n&&e.jsx(x,{type:"primary",icon:e.jsx(v,{}),onClick:()=>f.getState().onOpen(),children:"Yangi IELTS Test"}),e.jsx(w,{open:h,width:600,onCancel:l,destroyOnClose:!0,onOk:t.submit,title:i?"IELTS testini tahrirlash":"Yangi IELTS test qo'shish",okText:i?"Saqlash":"Qo'shish",cancelText:"Bekor qilish",confirmLoading:a||m,modalRender:c=>e.jsx(j,{layout:"vertical",size:"large",onFinish:y,form:t,children:c}),children:e.jsx(Y,{})})]})},K=({onEdit:n,onDelete:t,onCopyId:o})=>[{key:"#",title:"#",render:(a,s,m)=>m+1},{key:"id",title:"ID",dataIndex:"id",className:"w-20",render:a=>e.jsx(x,{type:"link",icon:e.jsx(F,{size:16}),onClick:s=>{s.stopPropagation(),o(a)},style:{padding:0},children:e.jsx("span",{className:"text-start truncate w-20",children:a})})},{key:"title",title:"Nomi",dataIndex:"title"},{key:"createdAt",title:"Yaratilgan sana",dataIndex:"createdAt",render:a=>new Date(a).toLocaleDateString("uz-UZ")},{key:"updatedAt",title:"Yangilangan sana",dataIndex:"updatedAt",render:a=>new Date(a).toLocaleDateString("uz-UZ")},{key:"actions",title:"Amallar",render:a=>e.jsxs(L,{children:[e.jsx(x,{type:"primary",icon:e.jsx(P,{}),onClick:s=>{s.stopPropagation(),n(a)}}),e.jsx(x,{danger:!0,icon:e.jsx(M,{}),onClick:s=>{s.stopPropagation(),console.log("Delete button clicked, record:",a),a.id?t(a.id):console.error("Record has no ID:",a)}})]})}],B=()=>{const n=k();return C({mutationFn:async t=>(await T.delete(u.one(t))).data,onSuccess(){n.invalidateQueries({queryKey:[u.all]}),d.success("Muvaffaqiyatli o'chirildi")},onError:()=>{d.error("O'chirishda xatolik yuz berdi")}})},V=()=>{const{onOpen:n}=f(),[t,o]=O(),[a,s]=S.useState(!1),[m,h]=S.useState(""),p=parseInt(t.get("page")||"1"),i=parseInt(t.get("limit")||"10"),{data:l,isLoading:y}=A(),{mutate:c}=B(),g=r=>{h(r),s(!0)},E=()=>{c(m),s(!1),h("")},q=r=>{navigator.clipboard.writeText(r)},z=l?.data||[];return e.jsxs(e.Fragment,{children:[e.jsx(R,{pagination:{total:l?.meta?.total||l?.total||0,pageSize:i,current:p,showSizeChanger:!0,pageSizeOptions:[5,10,20,50,100],onChange:(r,D)=>{const I=new URLSearchParams(t);I.set("page",r.toString()),I.set("limit",D?.toString()||"10"),o(I)}},title:()=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{children:"IELTS Testlar"}),e.jsx(Q,{})]}),size:"small",loading:y,scroll:{x:"max-content"},dataSource:z,rowKey:r=>r.id||"",columns:K({onEdit:n,onDelete:g,onCopyId:q})}),e.jsx(w,{title:"Ishonchingiz komilmi?",open:a,onOk:E,onCancel:()=>s(!1),okText:"Ha",cancelText:"Yo'q",children:e.jsx("p",{children:"Ushbu IELTS testini o'chirishni xoxlaysizmi?"})})]})},_=()=>e.jsx("main",{children:e.jsx(V,{})});export{_ as default};
