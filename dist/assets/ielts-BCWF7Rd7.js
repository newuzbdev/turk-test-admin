import{j as e,x as C,y as S,z as h,A as c,D as d,a as f,B as p,M as E,E as T,F as b,v as q}from"./index-D8THizfA.js";import{c as w,R as z,C as v,S as F,E as R,a as L,u as P,F as M}from"./react-NF2a6keU.js";import{F as j,I as A}from"./index-C7xokAtH.js";const k=w(a=>({open:!1,data:null,onOpen:t=>a({open:!0,data:t||null}),onClose:()=>a({open:!1,data:null})})),D=()=>e.jsx(j.Item,{name:"title",label:"Test nomi",rules:[{required:!0,message:"Test nomini kiriting"}],children:e.jsx(A,{placeholder:"Test nomini kiriting",size:"middle"})}),O=()=>{const a=C();return S({mutationFn:async t=>(await h.post(d.all,t)).data,onSuccess:()=>{a.invalidateQueries({queryKey:[d.all]}),c.success({message:"Muvaffaqiyatli yaratildi",placement:"bottomRight"})},onError:()=>{c.error({message:"Yaratishda xatolik yuz berdi",placement:"bottomRight"})}})},N=()=>{const a=C();return S({mutationFn:async({id:t,...o})=>(await h.patch(d.one(t),o)).data,onSuccess:()=>{a.invalidateQueries({queryKey:[d.all]}),c.success({message:"Muvaffaqiyatli yangilandi",placement:"bottomRight"})},onError:()=>{c.error({message:"Yangilashda xatolik yuz berdi",placement:"bottomRight"})}})},Y=({hideAddButton:a=!1})=>{const[t]=j.useForm(),{mutateAsync:o,isPending:l}=O(),{mutateAsync:s,isPending:n}=N(),{open:u,onClose:x,data:r}=k(),y=()=>{t.resetFields(),x()};f.useEffect(()=>{r&&t.setFieldsValue(r)},[r,t]);const I=async m=>{try{r?r.id&&await s({...m,id:r.id}):await o(m),y()}catch(i){console.error("Error saving IELTS:",i)}};return e.jsxs("div",{className:"flex items-center justify-end",children:[!a&&e.jsx(p,{type:"primary",icon:e.jsx(z,{}),onClick:()=>k.getState().onOpen(),children:"Yangi IELTS Test"}),e.jsx(E,{open:u,width:600,onCancel:y,destroyOnClose:!0,onOk:t.submit,title:r?"IELTS testini tahrirlash":"Yangi IELTS test qo'shish",okText:r?"Saqlash":"Qo'shish",cancelText:"Bekor qilish",confirmLoading:l||n,modalRender:m=>e.jsx(j,{layout:"vertical",size:"large",onFinish:I,form:t,children:m}),children:e.jsx(D,{})})]})},Q=({onEdit:a,onDelete:t,onCopyId:o,navigate:l})=>[{key:"#",title:"#",render:(s,n,u)=>u+1},{key:"id",title:"ID",dataIndex:"id",className:"w-20",render:s=>e.jsx(p,{type:"link",icon:e.jsx(v,{size:16}),onClick:n=>o(s,n),style:{padding:0},children:e.jsx("span",{className:"text-start truncate w-20",children:s})})},{key:"title",title:"Nomi",dataIndex:"title"},{key:"createdAt",title:"Yaratilgan sana",dataIndex:"createdAt",render:s=>new Date(s).toLocaleDateString("uz-UZ")},{key:"updatedAt",title:"Yangilangan sana",dataIndex:"updatedAt",render:s=>new Date(s).toLocaleDateString("uz-UZ")},{key:"actions",title:"Amallar",render:s=>e.jsxs(F,{children:[e.jsx(p,{type:"primary",icon:e.jsx(T,{}),onClick:n=>{n.stopPropagation(),a(s)}}),e.jsx(p,{icon:e.jsx(R,{}),onClick:n=>{n.stopPropagation(),l(`/ielts/${s.id}`)}}),e.jsx(p,{danger:!0,icon:e.jsx(L,{}),onClick:n=>{n.stopPropagation(),t(s.id)}})]})}],K=()=>{const a=C();return S({mutationFn:async t=>(await h.delete(d.one(t))).data,onSuccess(){a.invalidateQueries({queryKey:[d.all]}),c.success({message:"Muvaffaqiyatli o'chirildi",placement:"bottomRight"})},onError:()=>{c.error({message:"O'chirishda xatolik yuz berdi",placement:"bottomRight"})}})},U=()=>{const[a]=b(),t=a.get("search"),o=parseInt(a.get("page")||"1"),l=parseInt(a.get("limit")||"10");return P({queryKey:[d.all,t,o,l],queryFn:async()=>(await h.get(d.all,{params:{page:o,limit:l,search:t}})).data})},B=()=>{const{onOpen:a}=k(),t=q(),[o,l]=f.useState(1),[s,n]=f.useState(10),{data:u,isLoading:x}=U(),r=K(),y=i=>{E.confirm({title:"Ishonchingiz komilmi?",content:"Ushbu IELTS testini o'chirishni xoxlaysizmi?",okText:"Ha",cancelText:"Yo'q",onOk:()=>{r.mutateAsync(i)}})},I=(i,g)=>{g.stopPropagation();try{navigator.clipboard.writeText(i),c.success({message:"Muvaffaqiyatli nusxa ko`chirildi"})}catch{c.error({message:"Nusxa ko`chirishda xatolik yuz berdi"})}},m=u?.data||[];return e.jsx(M,{pagination:{total:u?.meta?.total||0,pageSize:s,current:o,showSizeChanger:!0,pageSizeOptions:[5,10,20,50,100],onChange:(i,g)=>{l(i),n(g)}},title:()=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{children:"IELTS Testlar"}),e.jsx(Y,{})]}),size:"small",loading:x,scroll:{x:"max-content"},dataSource:m,rowKey:i=>i.id||"",onRow:i=>({onClick:g=>{g.target instanceof HTMLButtonElement||t(`/ielts/${i.id}`)}}),columns:Q({onEdit:a,onDelete:y,onCopyId:I,navigate:t})})},_=()=>e.jsx("main",{children:e.jsx(B,{})});export{_ as default};
