import{w as e,F as j,x as q,A as S,D as k,E as C,G as c,H as d,J as f,a as h,B as x,K as D,M as b,L as v,S as F,N as L,O as M,P as R,Q as O}from"./index-DlrNiIAW.js";const P=()=>e.jsx(j.Item,{name:"title",label:"Test nomi",rules:[{required:!0,message:"Test nomini kiriting"}],children:e.jsx(q,{placeholder:"Test nomini kiriting",size:"middle"})}),A=()=>{const a=S();return k({mutationFn:async s=>(await C.post(d.all,s)).data,onSuccess:()=>{a.invalidateQueries({queryKey:[d.all]}),c.success({message:"Muvaffaqiyatli yaratildi",placement:"bottomRight"})},onError:()=>{c.error({message:"Yaratishda xatolik yuz berdi",placement:"bottomRight"})}})},Y=()=>{const a=S();return k({mutationFn:async({id:s,...o})=>(await C.patch(d.one(s),o)).data,onSuccess:()=>{a.invalidateQueries({queryKey:[d.all]}),c.success({message:"Muvaffaqiyatli yangilandi",placement:"bottomRight"})},onError:()=>{c.error({message:"Yangilashda xatolik yuz berdi",placement:"bottomRight"})}})},N=({hideAddButton:a=!1})=>{const[s]=j.useForm(),{mutateAsync:o,isPending:t}=A(),{mutateAsync:i,isPending:u}=Y(),{open:m,onClose:p,data:n}=f(),g=()=>{s.resetFields(),p()};h.useEffect(()=>{n&&s.setFieldsValue(n)},[n,s]);const y=async r=>{try{n?n.id&&await i({...r,id:n.id}):await o(r),g()}catch(I){console.error("Error saving IELTS:",I)}};return e.jsxs("div",{className:"flex items-center justify-end",children:[!a&&e.jsx(x,{type:"primary",icon:e.jsx(D,{}),onClick:()=>f.getState().onOpen(),children:"Yangi IELTS Test"}),e.jsx(b,{open:m,width:600,onCancel:g,destroyOnClose:!0,onOk:s.submit,title:n?"IELTS testini tahrirlash":"Yangi IELTS test qo'shish",okText:n?"Saqlash":"Qo'shish",cancelText:"Bekor qilish",confirmLoading:t||u,modalRender:r=>e.jsx(j,{layout:"vertical",size:"large",onFinish:y,form:s,children:r}),children:e.jsx(P,{})})]})},Q=({onEdit:a,onDelete:s,onCopyId:o})=>[{key:"#",title:"#",render:(t,i,u)=>u+1},{key:"id",title:"ID",dataIndex:"id",className:"w-20",render:t=>e.jsx(x,{type:"link",icon:e.jsx(v,{size:16}),onClick:i=>{i.stopPropagation(),o(t)},style:{padding:0},children:e.jsx("span",{className:"text-start truncate w-20",children:t})})},{key:"title",title:"Nomi",dataIndex:"title"},{key:"createdAt",title:"Yaratilgan sana",dataIndex:"createdAt",render:t=>new Date(t).toLocaleDateString("uz-UZ")},{key:"updatedAt",title:"Yangilangan sana",dataIndex:"updatedAt",render:t=>new Date(t).toLocaleDateString("uz-UZ")},{key:"actions",title:"Amallar",render:t=>e.jsxs(F,{children:[e.jsx(x,{type:"primary",icon:e.jsx(L,{}),onClick:i=>{i.stopPropagation(),a(t)}}),e.jsx(x,{danger:!0,icon:e.jsx(M,{}),onClick:i=>{i.stopPropagation(),console.log("Delete button clicked, record:",t),t.id?s(t.id):console.error("Record has no ID:",t)}})]})}],K=()=>{const a=S();return k({mutationFn:async s=>(await C.delete(d.one(s))).data,onSuccess(){a.invalidateQueries({queryKey:[d.all]}),c.success({message:"Muvaffaqiyatli o'chirildi",placement:"bottomRight"})},onError:()=>{c.error({message:"O'chirishda xatolik yuz berdi",placement:"bottomRight"})}})},U=()=>{const{onOpen:a}=f(),[s,o]=h.useState(1),[t,i]=h.useState(10),[u,m]=h.useState(!1),[p,n]=h.useState(""),{data:g,isLoading:y}=R(),{mutate:r}=K(),I=l=>{n(l),m(!0)},T=()=>{r(p),m(!1),n("")},w=l=>{navigator.clipboard.writeText(l)},E=g?.data||[];return e.jsxs(e.Fragment,{children:[e.jsx(O,{pagination:{total:g?.meta?.total||0,pageSize:t,current:s,showSizeChanger:!0,pageSizeOptions:[5,10,20,50,100],onChange:(l,z)=>{o(l),i(z)}},title:()=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{children:"IELTS Testlar"}),e.jsx(N,{})]}),size:"small",loading:y,scroll:{x:"max-content"},dataSource:E,rowKey:l=>l.id||"",columns:Q({onEdit:a,onDelete:I,onCopyId:w})}),e.jsx(b,{title:"Ishonchingiz komilmi?",open:u,onOk:T,onCancel:()=>m(!1),okText:"Ha",cancelText:"Yo'q",children:e.jsx("p",{children:"Ushbu IELTS testini o'chirishni xoxlaysizmi?"})})]})},G=()=>e.jsx("main",{children:e.jsx(U,{})});export{G as default};
