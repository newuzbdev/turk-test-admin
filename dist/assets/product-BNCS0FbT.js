import{O as $,a4 as c,h as k,f as C,g as w,V as p,j as e,T as K,S as z,B as i,e as Y,m as Q,n as L,F as x,r as m,M as O,d as T,Z as _,a0 as q,l as V,q as U,$ as j,a3 as G}from"./index-C3S5N4EP.js";import{P as H,R as J}from"./ReloadOutlined-DBiuqoA3.js";const W=()=>$({queryKey:[c.all],queryFn:async()=>{try{const s=await k.get(c.all);return console.log("Raw Product API response:",s),console.log("Product response data:",s.data),s.data}catch(s){throw console.error("Product API Error:",s),s}}}),X=()=>{const s=C();return w({mutationFn:async a=>(await k.post(c.all,a)).data,onSuccess:()=>{s.invalidateQueries({queryKey:[c.all]}),p.success("Mahsulot muvaffaqiyatli yaratildi")},onError:a=>{console.error("Product creation error:",a);const t=a?.response?.data?.error||"Mahsulot yaratishda xatolik yuz berdi";p.error(t)}})},Z=()=>{const s=C();return w({mutationFn:async a=>{const{id:t,...r}=a;return(await k.patch(c.one(t),r)).data},onSuccess:()=>{s.invalidateQueries({queryKey:[c.all]}),p.success("Mahsulot muvaffaqiyatli yangilandi")},onError:a=>{console.error("Product update error:",a);const t=a?.response?.data?.error||"Mahsulot yangilashda xatolik yuz berdi";p.error(t)}})},ee=()=>{const s=C();return w({mutationFn:async a=>(await k.delete(c.one(a))).data,onSuccess:()=>{s.invalidateQueries({queryKey:[c.all]}),p.success("Mahsulot muvaffaqiyatli o'chirildi")},onError:a=>{console.error("Product deletion error:",a);const t=a?.response?.data?.error||"Mahsulot o'chirishda xatolik yuz berdi";p.error(t)}})},te=({onEdit:s,onDelete:a})=>[{title:"Nomi",dataIndex:"name",key:"name",ellipsis:!0,sorter:(t,r)=>t.name.localeCompare(r.name)},{title:"Narx",dataIndex:"price",key:"price",width:120,sorter:(t,r)=>t.price-r.price,render:t=>e.jsxs(K,{color:"blue",style:{fontSize:"14px",fontWeight:"bold"},children:[t.toLocaleString()," so'm"]})},{title:"Yaratilgan",dataIndex:"createdAt",key:"createdAt",width:120,render:t=>t?new Date(t).toLocaleDateString():"-"},{title:"Amallar",key:"actions",width:150,render:(t,r)=>e.jsxs(z,{size:"small",children:[e.jsx(i,{type:"text",icon:e.jsx(Y,{}),size:"small",title:"Ko'rish"}),e.jsx(i,{type:"text",icon:e.jsx(Q,{}),size:"small",title:"Tahrirlash",onClick:()=>s(r)}),e.jsx(H,{title:"Mahsulotni o'chirishni tasdiqlaysizmi?",okText:"Ha, o'chir",cancelText:"Bekor qilish",okButtonProps:{danger:!0},onConfirm:()=>a(r.id??r._id),children:e.jsx(i,{type:"text",danger:!0,icon:e.jsx(L,{}),size:"small",title:"O'chirish"})})]})}];function ae({open:s,onClose:a,product:t,mode:r}){const[n]=x.useForm(),{mutate:y,isPending:P}=X(),{mutate:f,isPending:M}=Z(),g=P||M;m.useEffect(()=>{s&&(r==="edit"&&t?n.setFieldsValue({name:t.name,price:t.price}):n.resetFields())},[s,r,t,n]);const d=async l=>{const h={...l};r==="create"?y(h,{onSuccess:()=>{n.resetFields(),a()}}):r==="edit"&&t?.id&&f({id:t.id,...h},{onSuccess:()=>{a()}})},u=()=>{n.resetFields(),a()};return e.jsx(O,{title:r==="create"?"Yangi Mahsulot Yaratish":"Mahsulot Tahrirlash",open:s,onCancel:u,footer:null,width:500,destroyOnClose:!0,children:e.jsxs(x,{form:n,layout:"vertical",onFinish:d,children:[e.jsx(x.Item,{name:"name",label:"Mahsulot nomi",rules:[{required:!0,message:"Mahsulot nomi kiritish kerak"},{min:2,message:"Nom kamida 2 ta belgi bo'lishi kerak"},{max:100,message:"Nom 100 ta belgidan ko'p bo'lmasligi kerak"}],children:e.jsx(T,{placeholder:"Masalan: iPhone 15 Pro",size:"large"})}),e.jsx(x.Item,{name:"price",label:"Narx (so'm)",rules:[{required:!0,message:"Narx kiritish kerak"},{type:"number",min:1,message:"Narx 1 dan katta bo'lishi kerak"},{type:"number",max:999999999,message:"Narx juda katta"}],children:e.jsx(_,{placeholder:"Masalan: 15000000",style:{width:"100%"},size:"large",formatter:l=>`${l}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:l=>Number(l.replace(/\$\s?|(,*)/g,""))||0,min:1,max:999999999})}),e.jsx(x.Item,{style:{marginBottom:0,marginTop:24},children:e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx(i,{onClick:u,disabled:g,size:"large",children:"Bekor qilish"}),e.jsx(i,{type:"primary",htmlType:"submit",loading:g,size:"large",children:r==="create"?"Yaratish":"Yangilash"})]})})]})})}const{Search:se}=T;function re(){const[s,a]=m.useState(""),[t,r]=m.useState([]),[n,y]=m.useState(!1),[P,f]=m.useState("create"),[M,g]=m.useState(null),{data:d,isLoading:u,refetch:l,error:h}=W(),{mutate:v,isPending:I}=ee(),b=Array.isArray(d?.data)?d.data:Array.isArray(d)?d:[];console.log("Product data:",d),console.log("Products array:",b),console.log("Loading:",u),console.log("Error:",h);const F=b.map(o=>({...o,id:o?.id??o?._id})).filter(o=>o.name.toLowerCase().includes(s.toLowerCase())),B=()=>{f("create"),g(null),y(!0)},A=o=>{f("edit"),g(o),y(!0)},E=o=>{if(!o){j.error("Mahsulot ID topilmadi");return}v(String(o),{onSuccess:()=>{j.success("Mahsulot o'chirildi")}})},R=()=>{if(t.length===0){j.warning("O'chirish uchun mahsulot tanlang");return}j.info("Bulk delete functionality to be implemented")},D={selectedRowKeys:t,onChange:r},N=te({onEdit:A,onDelete:E});return h?e.jsx(q,{children:e.jsxs("div",{style:{textAlign:"center",padding:"50px 0"},children:[e.jsx("h3",{children:"Xatolik yuz berdi"}),e.jsxs("p",{children:["Mahsulotlarni yuklashda xatolik: ",h.message]}),e.jsx(i,{type:"primary",onClick:()=>l(),children:"Qayta urinish"})]})}):e.jsxs(q,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(z,{wrap:!0,children:[e.jsx(se,{placeholder:"Mahsulot qidirish...",value:s,onChange:o=>a(o.target.value),style:{width:300},allowClear:!0}),e.jsx(i,{type:"primary",icon:e.jsx(V,{}),onClick:B,children:"Yangi Mahsulot"}),e.jsx(i,{icon:e.jsx(J,{}),onClick:()=>l(),loading:u,children:"Yangilash"}),t.length>0&&e.jsxs(i,{danger:!0,onClick:R,loading:I,children:["Tanlanganlarni o'chirish (",t.length,")"]})]})}),e.jsx(U,{columns:N,dataSource:F,rowKey:o=>o.id??o._id,loading:u,rowSelection:D,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(o,S)=>`${S[0]}-${S[1]} / ${o} ta mahsulot`},scroll:{x:600},locale:{emptyText:u?"Yuklanmoqda...":"Mahsulotlar topilmadi"}}),e.jsx(ae,{open:n,onClose:()=>y(!1),product:M,mode:P})]})}const{Title:oe}=G;function ce(){return e.jsxs("div",{style:{padding:24},children:[e.jsx(oe,{level:2,style:{marginBottom:24},children:"Mahsulot Boshqaruvi"}),e.jsx(re,{})]})}export{ce as default};
