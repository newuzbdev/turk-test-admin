import{O as Y,a4 as c,h as j,f as w,g as b,V as p,j as e,T as Q,S as q,B as i,e as Z,m as L,n as O,F as x,r as m,M as V,d as A,Z as G,a0 as T,l as U,q as J,$ as C,a3 as W}from"./index-9PL95cny.js";import{R as X}from"./ReloadOutlined-BaECXpbv.js";const _=()=>Y({queryKey:[c.all],queryFn:async()=>{try{const s=await j.get(c.all);return console.log("Raw Product API response:",s),console.log("Product response data:",s.data),s.data}catch(s){throw console.error("Product API Error:",s),s}}}),H=()=>{const s=w();return b({mutationFn:async a=>(await j.post(c.all,a)).data,onSuccess:()=>{s.invalidateQueries({queryKey:[c.all]}),p.success("Mahsulot muvaffaqiyatli yaratildi")},onError:a=>{console.error("Product creation error:",a);const t=a?.response?.data?.error||"Mahsulot yaratishda xatolik yuz berdi";p.error(t)}})},ee=()=>{const s=w();return b({mutationFn:async a=>{const{id:t,...r}=a;return(await j.patch(c.one(t),r)).data},onSuccess:()=>{s.invalidateQueries({queryKey:[c.all]}),p.success("Mahsulot muvaffaqiyatli yangilandi")},onError:a=>{console.error("Product update error:",a);const t=a?.response?.data?.error||"Mahsulot yangilashda xatolik yuz berdi";p.error(t)}})},te=()=>{const s=w();return b({mutationFn:async a=>(await j.delete(c.one(a))).data,onSuccess:()=>{s.invalidateQueries({queryKey:[c.all]}),p.success("Mahsulot muvaffaqiyatli o'chirildi")},onError:a=>{console.error("Product deletion error:",a);const t=a?.response?.data?.error||"Mahsulot o'chirishda xatolik yuz berdi";p.error(t)}})},ae=({onEdit:s,onDelete:a})=>[{title:"Nomi",dataIndex:"name",key:"name",ellipsis:!0,sorter:(t,r)=>t.name.localeCompare(r.name)},{title:"Narx",dataIndex:"price",key:"price",width:120,sorter:(t,r)=>t.price-r.price,render:t=>e.jsxs(Q,{color:"blue",style:{fontSize:"14px",fontWeight:"bold"},children:[t.toLocaleString()," so'm"]})},{title:"Yaratilgan",dataIndex:"createdAt",key:"createdAt",width:120,render:t=>t?new Date(t).toLocaleDateString():"-"},{title:"Amallar",key:"actions",width:150,render:(t,r)=>e.jsxs(q,{size:"small",children:[e.jsx(i,{type:"text",icon:e.jsx(Z,{}),size:"small",title:"Ko'rish"}),e.jsx(i,{type:"text",icon:e.jsx(L,{}),size:"small",title:"Tahrirlash",onClick:()=>s(r)}),e.jsx(i,{type:"text",danger:!0,icon:e.jsx(O,{}),size:"small",title:"O'chirish",onClick:()=>a(r.id)})]})}];function se({open:s,onClose:a,product:t,mode:r}){const[o]=x.useForm(),{mutate:y,isPending:k}=H(),{mutate:f,isPending:P}=ee(),g=k||P;m.useEffect(()=>{s&&(r==="edit"&&t?o.setFieldsValue({name:t.name,price:t.price}):o.resetFields())},[s,r,t,o]);const d=async l=>{const h={...l};r==="create"?y(h,{onSuccess:()=>{o.resetFields(),a()}}):r==="edit"&&t?.id&&f({id:t.id,...h},{onSuccess:()=>{a()}})},u=()=>{o.resetFields(),a()};return e.jsx(V,{title:r==="create"?"Yangi Mahsulot Yaratish":"Mahsulot Tahrirlash",open:s,onCancel:u,footer:null,width:500,destroyOnClose:!0,children:e.jsxs(x,{form:o,layout:"vertical",onFinish:d,children:[e.jsx(x.Item,{name:"name",label:"Mahsulot nomi",rules:[{required:!0,message:"Mahsulot nomi kiritish kerak"},{min:2,message:"Nom kamida 2 ta belgi bo'lishi kerak"},{max:100,message:"Nom 100 ta belgidan ko'p bo'lmasligi kerak"}],children:e.jsx(A,{placeholder:"Masalan: iPhone 15 Pro",size:"large"})}),e.jsx(x.Item,{name:"price",label:"Narx (so'm)",rules:[{required:!0,message:"Narx kiritish kerak"},{type:"number",min:1,message:"Narx 1 dan katta bo'lishi kerak"},{type:"number",max:999999999,message:"Narx juda katta"}],children:e.jsx(G,{placeholder:"Masalan: 15000000",style:{width:"100%"},size:"large",formatter:l=>`${l}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:l=>Number(l.replace(/\$\s?|(,*)/g,""))||0,min:1,max:999999999})}),e.jsx(x.Item,{style:{marginBottom:0,marginTop:24},children:e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[e.jsx(i,{onClick:u,disabled:g,size:"large",children:"Bekor qilish"}),e.jsx(i,{type:"primary",htmlType:"submit",loading:g,size:"large",children:r==="create"?"Yaratish":"Yangilash"})]})})]})})}const{Search:re}=A;function oe(){const[s,a]=m.useState(""),[t,r]=m.useState([]),[o,y]=m.useState(!1),[k,f]=m.useState("create"),[P,g]=m.useState(null),{data:d,isLoading:u,refetch:l,error:h}=_(),{mutate:v,isPending:z}=te(),M=Array.isArray(d?.data)?d.data:Array.isArray(d)?d:[],I=[{id:"1",name:"iPhone 15 Pro",price:15e6,createdAt:"2024-01-01T10:00:00Z",updatedAt:"2024-01-01T10:00:00Z"},{id:"2",name:"Samsung Galaxy S24",price:12e6,createdAt:"2024-01-02T10:00:00Z",updatedAt:"2024-01-02T10:00:00Z"},{id:"3",name:"MacBook Pro M3",price:25e6,createdAt:"2024-01-03T10:00:00Z",updatedAt:"2024-01-03T10:00:00Z"}],F=M.length>0?M:I;console.log("Product data:",d),console.log("Products array:",M),console.log("Loading:",u),console.log("Error:",h);const B=F.filter(n=>n.name.toLowerCase().includes(s.toLowerCase())),E=()=>{f("create"),g(null),y(!0)},R=n=>{f("edit"),g(n),y(!0)},N=n=>{v(n,{onSuccess:()=>{C.success("Mahsulot o'chirildi")}})},$=()=>{if(t.length===0){C.warning("O'chirish uchun mahsulot tanlang");return}C.info("Bulk delete functionality to be implemented")},D={selectedRowKeys:t,onChange:r},K=ae({onEdit:R,onDelete:N});return h?e.jsx(T,{children:e.jsxs("div",{style:{textAlign:"center",padding:"50px 0"},children:[e.jsx("h3",{children:"Xatolik yuz berdi"}),e.jsxs("p",{children:["Mahsulotlarni yuklashda xatolik: ",h.message]}),e.jsx(i,{type:"primary",onClick:()=>l(),children:"Qayta urinish"})]})}):e.jsxs(T,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(q,{wrap:!0,children:[e.jsx(re,{placeholder:"Mahsulot qidirish...",value:s,onChange:n=>a(n.target.value),style:{width:300},allowClear:!0}),e.jsx(i,{type:"primary",icon:e.jsx(U,{}),onClick:E,children:"Yangi Mahsulot"}),e.jsx(i,{icon:e.jsx(X,{}),onClick:()=>l(),loading:u,children:"Yangilash"}),t.length>0&&e.jsxs(i,{danger:!0,onClick:$,loading:z,children:["Tanlanganlarni o'chirish (",t.length,")"]})]})}),e.jsx(J,{columns:K,dataSource:B,rowKey:"id",loading:u,rowSelection:D,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(n,S)=>`${S[0]}-${S[1]} / ${n} ta mahsulot`},scroll:{x:600},locale:{emptyText:u?"Yuklanmoqda...":"Mahsulotlar topilmadi"}}),e.jsx(se,{open:o,onClose:()=>y(!1),product:P,mode:k})]})}const{Title:ne}=W;function ce(){return e.jsxs("div",{style:{padding:24},children:[e.jsx(ne,{level:2,style:{marginBottom:24},children:"Mahsulot Boshqaruvi"}),e.jsx(oe,{})]})}export{ce as default};
