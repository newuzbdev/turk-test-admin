import{w as e,F as j,x as D,A as k,D as C,E as T,G as d,H as u,J as f,a as S,B as h,K as L,M as b,L as P,S as R,N as v,O as F,P as M,Q as O,T as A}from"./index-Os-lhzLs.js";const Y=()=>e.jsx(j.Item,{name:"title",label:"Test nomi",rules:[{required:!0,message:"Test nomini kiriting"}],children:e.jsx(D,{placeholder:"Test nomini kiriting",size:"middle"})}),N=()=>{const n=k();return C({mutationFn:async t=>(await T.post(u.all,t)).data,onSuccess:()=>{n.invalidateQueries({queryKey:[u.all]}),d.success({message:"Muvaffaqiyatli yaratildi",placement:"bottomRight"})},onError:()=>{d.error({message:"Yaratishda xatolik yuz berdi",placement:"bottomRight"})}})},Q=()=>{const n=k();return C({mutationFn:async({id:t,...o})=>(await T.patch(u.one(t),o)).data,onSuccess:()=>{n.invalidateQueries({queryKey:[u.all]}),d.success({message:"Muvaffaqiyatli yangilandi",placement:"bottomRight"})},onError:()=>{d.error({message:"Yangilashda xatolik yuz berdi",placement:"bottomRight"})}})},U=({hideAddButton:n=!1})=>{const[t]=j.useForm(),{mutateAsync:o,isPending:a}=N(),{mutateAsync:s,isPending:m}=Q(),{open:g,onClose:p,data:i}=f(),r=()=>{t.resetFields(),p()};S.useEffect(()=>{i&&t.setFieldsValue(i)},[i,t]);const x=async c=>{try{i?i.id&&await s({...c,id:i.id}):await o(c),r()}catch(y){console.error("Error saving IELTS:",y)}};return e.jsxs("div",{className:"flex items-center justify-end",children:[!n&&e.jsx(h,{type:"primary",icon:e.jsx(L,{}),onClick:()=>f.getState().onOpen(),children:"Yangi IELTS Test"}),e.jsx(b,{open:g,width:600,onCancel:r,destroyOnClose:!0,onOk:t.submit,title:i?"IELTS testini tahrirlash":"Yangi IELTS test qo'shish",okText:i?"Saqlash":"Qo'shish",cancelText:"Bekor qilish",confirmLoading:a||m,modalRender:c=>e.jsx(j,{layout:"vertical",size:"large",onFinish:x,form:t,children:c}),children:e.jsx(Y,{})})]})},K=({onEdit:n,onDelete:t,onCopyId:o})=>[{key:"#",title:"#",render:(a,s,m)=>m+1},{key:"id",title:"ID",dataIndex:"id",className:"w-20",render:a=>e.jsx(h,{type:"link",icon:e.jsx(P,{size:16}),onClick:s=>{s.stopPropagation(),o(a)},style:{padding:0},children:e.jsx("span",{className:"text-start truncate w-20",children:a})})},{key:"title",title:"Nomi",dataIndex:"title"},{key:"createdAt",title:"Yaratilgan sana",dataIndex:"createdAt",render:a=>new Date(a).toLocaleDateString("uz-UZ")},{key:"updatedAt",title:"Yangilangan sana",dataIndex:"updatedAt",render:a=>new Date(a).toLocaleDateString("uz-UZ")},{key:"actions",title:"Amallar",render:a=>e.jsxs(R,{children:[e.jsx(h,{type:"primary",icon:e.jsx(v,{}),onClick:s=>{s.stopPropagation(),n(a)}}),e.jsx(h,{danger:!0,icon:e.jsx(F,{}),onClick:s=>{s.stopPropagation(),console.log("Delete button clicked, record:",a),a.id?t(a.id):console.error("Record has no ID:",a)}})]})}],B=()=>{const n=k();return C({mutationFn:async t=>(await T.delete(u.one(t))).data,onSuccess(){n.invalidateQueries({queryKey:[u.all]}),d.success({message:"Muvaffaqiyatli o'chirildi",placement:"bottomRight"})},onError:()=>{d.error({message:"O'chirishda xatolik yuz berdi",placement:"bottomRight"})}})},G=()=>{const{onOpen:n}=f(),[t,o]=M(),[a,s]=S.useState(!1),[m,g]=S.useState(""),p=parseInt(t.get("page")||"1"),i=parseInt(t.get("limit")||"10"),{data:r,isLoading:x}=O(),{mutate:c}=B(),y=l=>{g(l),s(!0)},w=()=>{c(m),s(!1),g("")},E=l=>{navigator.clipboard.writeText(l)},q=r?.data||[];return e.jsxs(e.Fragment,{children:[e.jsx(A,{pagination:{total:r?.meta?.total||r?.total||0,pageSize:i,current:p,showSizeChanger:!0,pageSizeOptions:[5,10,20,50,100],onChange:(l,z)=>{const I=new URLSearchParams(t);I.set("page",l.toString()),I.set("limit",z?.toString()||"10"),o(I)}},title:()=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{children:"IELTS Testlar"}),e.jsx(U,{})]}),size:"small",loading:x,scroll:{x:"max-content"},dataSource:q,rowKey:l=>l.id||"",columns:K({onEdit:n,onDelete:y,onCopyId:E})}),e.jsx(b,{title:"Ishonchingiz komilmi?",open:a,onOk:w,onCancel:()=>s(!1),okText:"Ha",cancelText:"Yo'q",children:e.jsx("p",{children:"Ushbu IELTS testini o'chirishni xoxlaysizmi?"})})]})},Z=()=>e.jsx("main",{children:e.jsx(G,{})});export{Z as default};
