import{j as e,F as j,c as v,e as k,f as C,g as T,V as w,i as d,s as g,h as f,r as S,B as h,k as F,M as b,C as L,S as M,l as P,m as R,n as O,o as A,p as Y}from"./index-BCj1WIYu.js";const U=()=>e.jsx(j.Item,{name:"title",label:"Test nomi",rules:[{required:!0,message:"Test nomini kiriting"}],children:e.jsx(v,{placeholder:"Test nomini kiriting",size:"middle"})}),N=()=>{const n=k();return C({mutationFn:async t=>(await T.post(d.all,t)).data,onSuccess:()=>{n.invalidateQueries({queryKey:[d.all]}),w.success("Muvaffaqiyatli yaratildi")},onError:()=>{w.error("Yaratishda xatolik yuz berdi")}})},Q=()=>{const n=k();return C({mutationFn:async({id:t,...o})=>(await T.patch(d.one(t),o)).data,onSuccess:()=>{n.invalidateQueries({queryKey:[d.all]}),g.success({message:"Muvaffaqiyatli yangilandi",placement:"bottomRight"})},onError:()=>{g.error({message:"Yangilashda xatolik yuz berdi",placement:"bottomRight"})}})},K=({hideAddButton:n=!1})=>{const[t]=j.useForm(),{mutateAsync:o,isPending:a}=N(),{mutateAsync:s,isPending:u}=Q(),{open:m,onClose:p,data:i}=f(),l=()=>{t.resetFields(),p()};S.useEffect(()=>{i&&t.setFieldsValue(i)},[i,t]);const x=async c=>{try{i?i.id&&await s({...c,id:i.id}):await o(c),l()}catch(y){console.error("Error saving IELTS:",y)}};return e.jsxs("div",{className:"flex items-center justify-end",children:[!n&&e.jsx(h,{type:"primary",icon:e.jsx(F,{}),onClick:()=>f.getState().onOpen(),children:"Yangi IELTS Test"}),e.jsx(b,{open:m,width:600,onCancel:l,destroyOnClose:!0,onOk:t.submit,title:i?"IELTS testini tahrirlash":"Yangi IELTS test qo'shish",okText:i?"Saqlash":"Qo'shish",cancelText:"Bekor qilish",confirmLoading:a||u,modalRender:c=>e.jsx(j,{layout:"vertical",size:"large",onFinish:x,form:t,children:c}),children:e.jsx(U,{})})]})},B=({onEdit:n,onDelete:t,onCopyId:o})=>[{key:"#",title:"#",render:(a,s,u)=>u+1},{key:"id",title:"ID",dataIndex:"id",className:"w-20",render:a=>e.jsx(h,{type:"link",icon:e.jsx(L,{size:16}),onClick:s=>{s.stopPropagation(),o(a)},style:{padding:0},children:e.jsx("span",{className:"text-start truncate w-20",children:a})})},{key:"title",title:"Nomi",dataIndex:"title"},{key:"createdAt",title:"Yaratilgan sana",dataIndex:"createdAt",render:a=>new Date(a).toLocaleDateString("uz-UZ")},{key:"updatedAt",title:"Yangilangan sana",dataIndex:"updatedAt",render:a=>new Date(a).toLocaleDateString("uz-UZ")},{key:"actions",title:"Amallar",render:a=>e.jsxs(M,{children:[e.jsx(h,{type:"primary",icon:e.jsx(P,{}),onClick:s=>{s.stopPropagation(),n(a)}}),e.jsx(h,{danger:!0,icon:e.jsx(R,{}),onClick:s=>{s.stopPropagation(),console.log("Delete button clicked, record:",a),a.id?t(a.id):console.error("Record has no ID:",a)}})]})}],V=()=>{const n=k();return C({mutationFn:async t=>(await T.delete(d.one(t))).data,onSuccess(){n.invalidateQueries({queryKey:[d.all]}),g.success({message:"Muvaffaqiyatli o'chirildi",placement:"bottomRight"})},onError:()=>{g.error({message:"O'chirishda xatolik yuz berdi",placement:"bottomRight"})}})},Z=()=>{const{onOpen:n}=f(),[t,o]=O(),[a,s]=S.useState(!1),[u,m]=S.useState(""),p=parseInt(t.get("page")||"1"),i=parseInt(t.get("limit")||"10"),{data:l,isLoading:x}=A(),{mutate:c}=V(),y=r=>{m(r),s(!0)},E=()=>{c(u),s(!1),m("")},q=r=>{navigator.clipboard.writeText(r)},z=l?.data||[];return e.jsxs(e.Fragment,{children:[e.jsx(Y,{pagination:{total:l?.meta?.total||l?.total||0,pageSize:i,current:p,showSizeChanger:!0,pageSizeOptions:[5,10,20,50,100],onChange:(r,D)=>{const I=new URLSearchParams(t);I.set("page",r.toString()),I.set("limit",D?.toString()||"10"),o(I)}},title:()=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{children:"IELTS Testlar"}),e.jsx(K,{})]}),size:"small",loading:x,scroll:{x:"max-content"},dataSource:z,rowKey:r=>r.id||"",columns:B({onEdit:n,onDelete:y,onCopyId:q})}),e.jsx(b,{title:"Ishonchingiz komilmi?",open:a,onOk:E,onCancel:()=>s(!1),okText:"Ha",cancelText:"Yo'q",children:e.jsx("p",{children:"Ushbu IELTS testini o'chirishni xoxlaysizmi?"})})]})},$=()=>e.jsx("main",{children:e.jsx(Z,{})});export{$ as default};
