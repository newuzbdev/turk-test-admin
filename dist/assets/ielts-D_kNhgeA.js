import{j as e,F as j,d as b,f as k,g as C,h as T,V as c,i as d,k as f,r as S,B as x,l as v,M as w,C as F,S as L,m as P,n as M,o as O,p as A,q as R}from"./index-C32iiZxf.js";const Y=()=>e.jsx(j.Item,{name:"title",label:"Test nomi",rules:[{required:!0,message:"Test nomini kiriting"}],children:e.jsx(b,{placeholder:"Test nomini kiriting",size:"middle"})}),U=()=>{const n=k();return C({mutationFn:async t=>(await T.post(d.all,t)).data,onSuccess:()=>{n.invalidateQueries({queryKey:[d.all]}),c.success("Muvaffaqiyatli yaratildi")},onError:()=>{c.error("Yaratishda xatolik yuz berdi")}})},N=()=>{const n=k();return C({mutationFn:async({id:t,...o})=>(await T.patch(d.one(t),o)).data,onSuccess:()=>{n.invalidateQueries({queryKey:[d.all]}),c.success("Muvaffaqiyatli yangilandi")},onError:()=>{c.error("Yangilashda xatolik yuz berdi")}})},Q=({hideAddButton:n=!1})=>{const[t]=j.useForm(),{mutateAsync:o,isPending:a}=U(),{mutateAsync:s,isPending:u}=N(),{open:h,onClose:p,data:i}=f(),m=()=>{t.resetFields(),p()};S.useEffect(()=>{i&&t.setFieldsValue(i)},[i,t]);const y=async l=>{try{i?i.id&&await s({...l,id:i.id}):await o(l),m()}catch(g){console.error("Error saving IELTS:",g)}};return e.jsxs("div",{className:"flex items-center justify-end",children:[!n&&e.jsx(x,{type:"primary",icon:e.jsx(v,{}),onClick:()=>f.getState().onOpen(),children:"Yangi IELTS Test"}),e.jsx(w,{open:h,width:600,onCancel:m,destroyOnClose:!0,onOk:t.submit,title:i?"IELTS testini tahrirlash":"Yangi IELTS test qo'shish",okText:i?"Saqlash":"Qo'shish",cancelText:"Bekor qilish",confirmLoading:a||u,modalRender:l=>e.jsx(j,{layout:"vertical",size:"large",onFinish:y,form:t,children:l}),children:e.jsx(Y,{})})]})},K=({onEdit:n,onDelete:t,onCopyId:o})=>[{key:"#",title:"#",render:(a,s,u)=>u+1},{key:"id",title:"ID",dataIndex:"id",className:"w-20",render:a=>e.jsx(x,{type:"link",icon:e.jsx(F,{size:16}),onClick:s=>{s.stopPropagation(),o(a)},style:{padding:0},children:e.jsx("span",{className:"text-start truncate w-20",children:a})})},{key:"title",title:"Nomi",dataIndex:"title"},{key:"createdAt",title:"Yaratilgan sana",dataIndex:"createdAt",render:a=>new Date(a).toLocaleDateString("uz-UZ")},{key:"updatedAt",title:"Yangilangan sana",dataIndex:"updatedAt",render:a=>new Date(a).toLocaleDateString("uz-UZ")},{key:"actions",title:"Amallar",render:a=>e.jsxs(L,{children:[e.jsx(x,{type:"primary",icon:e.jsx(P,{}),onClick:s=>{s.stopPropagation(),n(a)}}),e.jsx(x,{danger:!0,icon:e.jsx(M,{}),onClick:s=>{s.stopPropagation(),console.log("Delete button clicked, record:",a),a.id?t(a.id):console.error("Record has no ID:",a)}})]})}],B=()=>{const n=k();return C({mutationFn:async t=>(await T.delete(d.one(t))).data,onSuccess(){n.invalidateQueries({queryKey:[d.all]}),c.success("Muvaffaqiyatli o'chirildi")},onError:()=>{c.error("O'chirishda xatolik yuz berdi")}})},V=()=>{const{onOpen:n}=f(),[t,o]=O(),[a,s]=S.useState(!1),[u,h]=S.useState(""),p=parseInt(t.get("page")||"1"),i=parseInt(t.get("limit")||"10"),{data:m,isLoading:y}=A(),{mutate:l}=B(),g=r=>{h(r),s(!0)},q=()=>{l(u),s(!1),h("")},E=r=>{navigator.clipboard.writeText(r)},z=m?.ieltsData||[];return e.jsxs(e.Fragment,{children:[e.jsx(R,{pagination:{total:m?.total||0,pageSize:i,current:p,showSizeChanger:!0,pageSizeOptions:[5,10,20,50,100],onChange:(r,D)=>{const I=new URLSearchParams(t);I.set("page",r.toString()),I.set("limit",D?.toString()||"10"),o(I)}},title:()=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{children:"IELTS Testlar"}),e.jsx(Q,{})]}),size:"small",loading:y,scroll:{x:"max-content"},dataSource:z,rowKey:r=>r.id||"",columns:K({onEdit:n,onDelete:g,onCopyId:E})}),e.jsx(w,{title:"Ishonchingiz komilmi?",open:a,onOk:q,onCancel:()=>s(!1),okText:"Ha",cancelText:"Yo'q",children:e.jsx("p",{children:"Ushbu IELTS testini o'chirishni xoxlaysizmi?"})})]})},_=()=>e.jsx("main",{children:e.jsx(V,{})});export{_ as default};
