import{r as u,s as ne,t as X,v as ae,w as _,x as K,_ as ie,K as W,y as te,z as se,A as re,D as j,E as le,G as oe,H as ce,J as de,L as he,W as ue,N as ge,O as me,P as B,h as N,f as O,g as L,V as P,j as i,Q as pe,T as ye,S as Q,B as $,e as xe,m as Se,n as Y,F as v,U as fe,M as ke,d as D,X as Ce,Y as $e,Z as ve,$ as z,a0 as V,a1 as Ie,a2 as G,l as we,q as be,a3 as je}from"./index-C3S5N4EP.js";import{P as Be,R as Me}from"./ReloadOutlined-DBiuqoA3.js";var Ee=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],J=u.forwardRef(function(e,n){var a,t=e.prefixCls,l=t===void 0?"rc-switch":t,c=e.className,d=e.checked,s=e.defaultChecked,r=e.disabled,o=e.loadingIcon,g=e.checkedChildren,p=e.unCheckedChildren,S=e.onClick,y=e.onChange,k=e.onKeyDown,I=ne(e,Ee),M=X(!1,{value:d,defaultValue:s}),w=ae(M,2),f=w[0],m=w[1];function E(x,q){var b=f;return r||(b=x,m(b),y?.(b,q)),b}function R(x){x.which===W.LEFT?E(!1,x):x.which===W.RIGHT&&E(!0,x),k?.(x)}function C(x){var q=E(!f,x);S?.(q,x)}var A=_(l,c,(a={},K(a,"".concat(l,"-checked"),f),K(a,"".concat(l,"-disabled"),r),a));return u.createElement("button",ie({},I,{type:"button",role:"switch","aria-checked":f,disabled:r,className:A,ref:n,onKeyDown:R,onClick:C}),o,u.createElement("span",{className:"".concat(l,"-inner")},u.createElement("span",{className:"".concat(l,"-inner-checked")},g),u.createElement("span",{className:"".concat(l,"-inner-unchecked")},p)))});J.displayName="Switch";const qe=e=>{const{componentCls:n,trackHeightSM:a,trackPadding:t,trackMinWidthSM:l,innerMinMarginSM:c,innerMaxMarginSM:d,handleSizeSM:s,calc:r}=e,o=`${n}-inner`,g=j(r(s).add(r(t).mul(2)).equal()),p=j(r(d).mul(2).equal());return{[n]:{[`&${n}-small`]:{minWidth:l,height:a,lineHeight:j(a),[`${n}-inner`]:{paddingInlineStart:d,paddingInlineEnd:c,[`${o}-checked, ${o}-unchecked`]:{minHeight:a},[`${o}-checked`]:{marginInlineStart:`calc(-100% + ${g} - ${p})`,marginInlineEnd:`calc(100% - ${g} + ${p})`},[`${o}-unchecked`]:{marginTop:r(a).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${n}-handle`]:{width:s,height:s},[`${n}-loading-icon`]:{top:r(r(s).sub(e.switchLoadingIconSize)).div(2).equal(),fontSize:e.switchLoadingIconSize},[`&${n}-checked`]:{[`${n}-inner`]:{paddingInlineStart:c,paddingInlineEnd:d,[`${o}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${o}-unchecked`]:{marginInlineStart:`calc(100% - ${g} + ${p})`,marginInlineEnd:`calc(-100% + ${g} - ${p})`}},[`${n}-handle`]:{insetInlineStart:`calc(100% - ${j(r(s).add(t).equal())})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${o}`]:{[`${o}-unchecked`]:{marginInlineStart:r(e.marginXXS).div(2).equal(),marginInlineEnd:r(e.marginXXS).mul(-1).div(2).equal()}},[`&${n}-checked ${o}`]:{[`${o}-checked`]:{marginInlineStart:r(e.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:r(e.marginXXS).div(2).equal()}}}}}}},ze=e=>{const{componentCls:n,handleSize:a,calc:t}=e;return{[n]:{[`${n}-loading-icon${e.iconCls}`]:{position:"relative",top:t(t(a).sub(e.fontSize)).div(2).equal(),color:e.switchLoadingIconColor,verticalAlign:"top"},[`&${n}-checked ${n}-loading-icon`]:{color:e.switchColor}}}},Te=e=>{const{componentCls:n,trackPadding:a,handleBg:t,handleShadow:l,handleSize:c,calc:d}=e,s=`${n}-handle`;return{[n]:{[s]:{position:"absolute",top:a,insetInlineStart:a,width:c,height:c,transition:`all ${e.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:t,borderRadius:d(c).div(2).equal(),boxShadow:l,transition:`all ${e.switchDuration} ease-in-out`,content:'""'}},[`&${n}-checked ${s}`]:{insetInlineStart:`calc(100% - ${j(d(c).add(a).equal())})`},[`&:not(${n}-disabled):active`]:{[`${s}::before`]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},[`&${n}-checked ${s}::before`]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},Pe=e=>{const{componentCls:n,trackHeight:a,trackPadding:t,innerMinMargin:l,innerMaxMargin:c,handleSize:d,calc:s}=e,r=`${n}-inner`,o=j(s(d).add(s(t).mul(2)).equal()),g=j(s(c).mul(2).equal());return{[n]:{[r]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:c,paddingInlineEnd:l,transition:`padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`,[`${r}-checked, ${r}-unchecked`]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:`margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:a},[`${r}-checked`]:{marginInlineStart:`calc(-100% + ${o} - ${g})`,marginInlineEnd:`calc(100% - ${o} + ${g})`},[`${r}-unchecked`]:{marginTop:s(a).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${n}-checked ${r}`]:{paddingInlineStart:l,paddingInlineEnd:c,[`${r}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${r}-unchecked`]:{marginInlineStart:`calc(100% - ${o} + ${g})`,marginInlineEnd:`calc(-100% + ${o} - ${g})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${r}`]:{[`${r}-unchecked`]:{marginInlineStart:s(t).mul(2).equal(),marginInlineEnd:s(t).mul(-1).mul(2).equal()}},[`&${n}-checked ${r}`]:{[`${r}-checked`]:{marginInlineStart:s(t).mul(-1).mul(2).equal(),marginInlineEnd:s(t).mul(2).equal()}}}}}},Re=e=>{const{componentCls:n,trackHeight:a,trackMinWidth:t}=e;return{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},re(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:t,height:a,lineHeight:j(a),verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${e.motionDurationMid}`,userSelect:"none",[`&:hover:not(${n}-disabled)`]:{background:e.colorTextTertiary}}),le(e)),{[`&${n}-checked`]:{background:e.switchColor,[`&:hover:not(${n}-disabled)`]:{background:e.colorPrimaryHover}},[`&${n}-loading, &${n}-disabled`]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${n}-rtl`]:{direction:"rtl"}})}},Ae=e=>{const{fontSize:n,lineHeight:a,controlHeight:t,colorWhite:l}=e,c=n*a,d=t/2,s=2,r=c-s*2,o=d-s*2;return{trackHeight:c,trackHeightSM:d,trackMinWidth:r*2+s*4,trackMinWidthSM:o*2+s*2,trackPadding:s,handleBg:l,handleSize:r,handleSizeSM:o,handleShadow:`0 2px 4px 0 ${new oe("#00230b").setA(.2).toRgbString()}`,innerMinMargin:r/2,innerMaxMargin:r+s+s*2,innerMinMarginSM:o/2,innerMaxMarginSM:o+s+s*2}},De=te("Switch",e=>{const n=se(e,{switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchLoadingIconSize:e.calc(e.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${e.opacityLoading})`,switchHandleActiveInset:"-30%"});return[Re(n),Pe(n),Te(n),ze(n),qe(n)]},Ae);var Ne=function(e,n){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(a[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,t=Object.getOwnPropertySymbols(e);l<t.length;l++)n.indexOf(t[l])<0&&Object.prototype.propertyIsEnumerable.call(e,t[l])&&(a[t[l]]=e[t[l]]);return a};const He=u.forwardRef((e,n)=>{const{prefixCls:a,size:t,disabled:l,loading:c,className:d,rootClassName:s,style:r,checked:o,value:g,defaultChecked:p,defaultValue:S,onChange:y}=e,k=Ne(e,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[I,M]=X(!1,{value:o??g,defaultValue:p??S}),{getPrefixCls:w,direction:f,switch:m}=u.useContext(ce),E=u.useContext(de),R=(l??E)||c,C=w("switch",a),A=u.createElement("div",{className:`${C}-handle`},c&&u.createElement(ge,{className:`${C}-loading-icon`})),[x,q,b]=De(C),h=he(t),T=_(m?.className,{[`${C}-small`]:h==="small",[`${C}-loading`]:c,[`${C}-rtl`]:f==="rtl"},d,s,q,b),H=Object.assign(Object.assign({},m?.style),r),ee=(...U)=>{M(U[0]),y?.apply(void 0,U)};return x(u.createElement(ue,{component:"Switch"},u.createElement(J,Object.assign({},k,{checked:I,onChange:ee,prefixCls:C,className:T,style:H,disabled:R,ref:n,loadingIcon:A}))))}),Z=He;Z.__ANT_SWITCH=!0;const Fe=()=>me({queryKey:[B.all],queryFn:async()=>{try{const e=await N.get(B.all);return console.log("Raw API response:",e),console.log("Response data:",e.data),e.data}catch(e){throw console.error("API Error:",e),e}}}),Oe=()=>{const e=O();return L({mutationFn:async n=>(await N.post(B.all,n)).data,onSuccess:()=>{e.invalidateQueries({queryKey:[B.all]}),P.success("Banner muvaffaqiyatli yaratildi")},onError:n=>{console.error("Banner creation error:",n);const a=n?.response?.data?.error||"Banner yaratishda xatolik yuz berdi";P.error(a)}})},Le=()=>{const e=O();return L({mutationFn:async n=>{const{id:a,...t}=n;return(await N.patch(B.one(a),t)).data},onSuccess:()=>{e.invalidateQueries({queryKey:[B.all]}),P.success("Banner muvaffaqiyatli yangilandi")},onError:n=>{console.error("Banner update error:",n);const a=n?.response?.data?.error||"Banner yangilashda xatolik yuz berdi";P.error(a)}})},Ue=()=>{const e=O();return L({mutationFn:async n=>(await N.delete(B.one(n))).data,onSuccess:()=>{e.invalidateQueries({queryKey:[B.all]}),P.success("Banner muvaffaqiyatli o'chirildi")},onError:n=>{console.error("Banner deletion error:",n);const a=n?.response?.data?.error||"Banner o'chirishda xatolik yuz berdi";P.error(a)}})},Ke=`${"https://api.turkishmock.uz".replace(/\/+$/,"")}/`,We=({onEdit:e,onDelete:n})=>[{title:"Rasm",dataIndex:"imageUrl",key:"imageUrl",width:100,render:a=>i.jsx(pe,{src:Ke+a,alt:"Banner",width:60,height:40,style:{objectFit:"cover",borderRadius:4}})},{title:"Nomi",dataIndex:"name",key:"name",ellipsis:!0},{title:"Sarlavha",dataIndex:"title",key:"title",ellipsis:!0},{title:"Tavsif",dataIndex:"description",key:"description",ellipsis:!0,render:a=>a||"-"},{title:"Link",dataIndex:"linkUrl",key:"linkUrl",ellipsis:!0,render:a=>a||"-"},{title:"Tartib",dataIndex:"order",key:"order",width:80,sorter:(a,t)=>(a.order||0)-(t.order||0)},{title:"Holat",dataIndex:"isActive",key:"isActive",width:100,render:a=>i.jsx(ye,{color:a?"green":"red",children:a?"Faol":"Nofaol"})},{title:"Amallar",key:"actions",width:150,render:(a,t)=>i.jsxs(Q,{size:"small",children:[i.jsx($,{type:"text",icon:i.jsx(xe,{}),size:"small",title:"Ko'rish"}),i.jsx($,{type:"text",icon:i.jsx(Se,{}),size:"small",title:"Tahrirlash",onClick:()=>e(t)}),i.jsx(Be,{title:"Bannerni o'chirishni tasdiqlaysizmi?",okText:"Ha, o'chir",cancelText:"Bekor qilish",okButtonProps:{danger:!0},onConfirm:()=>n(t.id??t._id),children:i.jsx($,{type:"text",danger:!0,icon:i.jsx(Y,{}),size:"small",title:"O'chirish"})})]})}],{TextArea:Ve}=D,Xe=`${"https://api.turkishmock.uz".replace(/\/+$/,"")}/`;function _e({open:e,onClose:n,banner:a,mode:t}){const[l]=v.useForm(),[c,d]=u.useState(""),[s,r]=u.useState(!1),{mutate:o,isPending:g}=Oe(),{mutate:p,isPending:S}=Le(),y=fe(),k=g||S;u.useEffect(()=>{e&&(t==="edit"&&a?(l.setFieldsValue({name:a.name,title:a.title,description:a.description,linkUrl:a.linkUrl,isActive:a.isActive??!0,order:a.order??1}),d(a.imageUrl)):(l.resetFields(),d("")))},[e,t,a,l]);const I=async f=>{try{r(!0);const m=await y.mutateAsync(f);m?.path&&(d(m.path),z.success("Rasm yuklandi"))}catch{z.error("Rasm yuklashda xatolik")}finally{r(!1)}return!1},M=async f=>{if(!c){z.error("Rasm yuklash kerak");return}const m={...f,imageUrl:c};t==="create"?o(m,{onSuccess:()=>{l.resetFields(),d(""),n()}}):t==="edit"&&a?.id&&p({id:a.id,...m},{onSuccess:()=>{n()}})},w=()=>{l.resetFields(),d(""),n()};return i.jsx(ke,{title:t==="create"?"Yangi Banner Yaratish":"Banner Tahrirlash",open:e,onCancel:w,footer:null,width:600,destroyOnClose:!0,children:i.jsxs(v,{form:l,layout:"vertical",onFinish:M,initialValues:{isActive:!0,order:1},children:[i.jsx(v.Item,{name:"name",label:"Nomi",rules:[{required:!0,message:"Nomi kiritish kerak"}],children:i.jsx(D,{placeholder:"Masalan: Summer Sale"})}),i.jsx(v.Item,{name:"title",label:"Sarlavha",rules:[{required:!0,message:"Sarlavha kiritish kerak"}],children:i.jsx(D,{placeholder:"Masalan: Big Discounts"})}),i.jsx(v.Item,{name:"description",label:"Tavsif",children:i.jsx(Ve,{rows:3,placeholder:"Banner haqida qisqacha ma'lumot..."})}),i.jsx(v.Item,{name:"linkUrl",label:"Havola URL",children:i.jsx(D,{placeholder:"https://example.com"})}),i.jsx(v.Item,{label:"Rasm",required:!0,children:i.jsxs("div",{children:[i.jsx(Ce,{showUploadList:!1,accept:"image/*",beforeUpload:I,children:i.jsx($,{icon:i.jsx($e,{}),loading:s,disabled:k,children:s?"Yuklanmoqda...":"Rasm yuklash"})}),c&&i.jsxs("div",{style:{marginTop:8},children:[i.jsx("img",{src:Xe+c,alt:"Preview",style:{width:"100%",maxHeight:200,objectFit:"contain",borderRadius:4,border:"1px solid #d9d9d9"}}),i.jsx($,{type:"text",danger:!0,icon:i.jsx(Y,{}),onClick:()=>d(""),style:{marginTop:4},children:"O'chirish"})]})]})}),i.jsxs("div",{style:{display:"flex",gap:16},children:[i.jsx(v.Item,{name:"isActive",label:"Faol",valuePropName:"checked",style:{flex:1},children:i.jsx(Z,{})}),i.jsx(v.Item,{name:"order",label:"Tartib",style:{flex:1},children:i.jsx(ve,{min:1,max:999,style:{width:"100%"}})})]}),i.jsx(v.Item,{style:{marginBottom:0,marginTop:24},children:i.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[i.jsx($,{onClick:w,disabled:k,children:"Bekor qilish"}),i.jsx($,{type:"primary",htmlType:"submit",loading:k,disabled:!c,children:t==="create"?"Yaratish":"Yangilash"})]})})]})})}const{Search:Qe}=D,{Option:F}=G;function Ye(){const[e,n]=u.useState(""),[a,t]=u.useState("all"),[l,c]=u.useState([]),[d,s]=u.useState(!1),[r,o]=u.useState("create"),[g,p]=u.useState(null),{data:S,isLoading:y,refetch:k,error:I}=Fe(),{mutate:M,isPending:w}=Ue(),f=Array.isArray(S?.data)?S.data:Array.isArray(S)?S:[];console.log("Banner data:",S),console.log("Banners array:",f),console.log("Loading:",y),console.log("Error:",I);const E=f.map(h=>({...h,id:h?.id??h?._id})).filter(h=>{const T=h.title.toLowerCase().includes(e.toLowerCase())||h.description&&h.description.toLowerCase().includes(e.toLowerCase()),H=a==="all"||a==="active"&&h.isActive||a==="inactive"&&!h.isActive;return T&&H}),R=()=>{o("create"),p(null),s(!0)},C=h=>{o("edit"),p(h),s(!0)},A=h=>{if(!h){z.error("Banner ID topilmadi");return}M(String(h),{onSuccess:()=>{z.success("Banner o'chirildi")}})},x=()=>{if(l.length===0){z.warning("O'chirish uchun banner tanlang");return}z.info("Bulk delete functionality to be implemented")},q={selectedRowKeys:l,onChange:c},b=We({onEdit:C,onDelete:A});return I?i.jsx(V,{children:i.jsxs("div",{style:{textAlign:"center",padding:"50px 0"},children:[i.jsx("h3",{children:"Xatolik yuz berdi"}),i.jsxs("p",{children:["Bannerlarni yuklashda xatolik: ",I.message]}),i.jsx($,{type:"primary",onClick:()=>k(),children:"Qayta urinish"})]})}):i.jsxs(V,{children:[i.jsx("div",{style:{marginBottom:16},children:i.jsxs(Q,{wrap:!0,children:[i.jsx(Qe,{placeholder:"Banner qidirish...",value:e,onChange:h=>n(h.target.value),style:{width:300},prefix:i.jsx(Ie,{})}),i.jsxs(G,{value:a,onChange:t,style:{width:120},children:[i.jsx(F,{value:"all",children:"Barchasi"}),i.jsx(F,{value:"active",children:"Faol"}),i.jsx(F,{value:"inactive",children:"Nofaol"})]}),i.jsx($,{type:"primary",icon:i.jsx(we,{}),onClick:R,children:"Yangi Banner"}),i.jsx($,{icon:i.jsx(Me,{}),onClick:()=>k(),loading:y,children:"Yangilash"}),l.length>0&&i.jsxs($,{danger:!0,onClick:x,loading:w,children:["Tanlanganlarni o'chirish (",l.length,")"]})]})}),i.jsx(be,{columns:b,dataSource:E,rowKey:h=>h.id??h._id,loading:y,rowSelection:q,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(h,T)=>`${T[0]}-${T[1]} / ${h} ta banner`},scroll:{x:800},locale:{emptyText:y?"Yuklanmoqda...":"Bannerlar topilmadi"}}),i.jsx(_e,{open:d,onClose:()=>s(!1),banner:g,mode:r})]})}const{Title:Ge}=je;function en(){return i.jsxs("div",{style:{padding:24},children:[i.jsx(Ge,{level:2,style:{marginBottom:24},children:"Banner Boshqaruvi"}),i.jsx(Ye,{})]})}export{en as default};
